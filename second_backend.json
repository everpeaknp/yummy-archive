[
  {
    "path": "/health",
    "method": "GET",
    "summary": "Health Check",
    "description": "Returns the status and version of the API.",
    "tags": ["System"],
    "parameters": [],
    "response": {
      "status": "ok",
      "version": "1.0.4-table-fix"
    }
  },
  {
    "path": "/debug/global-error",
    "method": "GET",
    "summary": "Get Global Error",
    "description": "Returns the last captured global error details.",
    "tags": ["Debug"],
    "parameters": [],
    "response": {
      "last_error": "object or null"
    }
  },
  {
    "path": "/debug/db-check",
    "method": "GET",
    "summary": "Database Check",
    "description": "Checks connections to configured databases (reader, deleter, internal).",
    "tags": ["Debug"],
    "parameters": [],
    "response": {
      "reader": "info",
      "deleter": "info",
      "internal": "info"
    }
  },
  {
    "path": "/jobs/archive",
    "method": "POST",
    "summary": "Create Archive Job",
    "description": "Initiates a background job to archive orders based on IDs or date range.",
    "tags": ["Jobs"],
    "request_body": {
      "type": "json",
      "fields": [
        {
          "name": "restaurant_id",
          "type": "integer",
          "required": true,
          "description": "ID of the restaurant"
        },
        {
          "name": "order_ids",
          "type": "array[integer]",
          "required": "conditional (msg: Provide order_ids or date range)",
          "description": "List of specific order IDs to archive"
        },
        {
          "name": "start_date",
          "type": "string",
          "required": "conditional",
          "description": "Start date for archive range"
        },
        {
          "name": "end_date",
          "type": "string",
          "required": "conditional",
          "description": "End date for archive range"
        },
        {
          "name": "user",
          "type": "string",
          "required": false,
          "default": "test_user",
          "description": "User initiating the job"
        }
      ]
    },
    "response": {
      "job_id": "string",
      "status": "string",
      "matched_count": "integer"
    }
  },
  {
    "path": "/jobs/archive/{job_id}",
    "method": "GET",
    "summary": "Get Archive Job Details",
    "description": "Retrieves status and details of a specific archive job.",
    "tags": ["Jobs"],
    "parameters": [
      {
        "name": "job_id",
        "in": "path",
        "type": "string",
        "required": true,
        "description": "UUID of the archive job"
      }
    ],
    "response": {
      "job_id": "string",
      "status": "string",
      "restaurant_id": "integer",
      "created_at": "datetime",
      "manifest_path": "string"
    }
  },
  {
    "path": "/jobs/delete",
    "method": "POST",
    "summary": "Create Delete Job",
    "description": "Initiates a hard deletion job for orders previously archived.",
    "tags": ["Jobs"],
    "request_body": {
      "type": "json",
      "fields": [
        {
          "name": "archive_job_id",
          "type": "string",
          "required": true,
          "description": "ID of the successfully completed archive job"
        },
        {
          "name": "restaurant_id",
          "type": "integer",
          "required": true,
          "description": "ID of the restaurant (must match archive job)"
        },
        {
          "name": "user",
          "type": "string",
          "required": false,
          "description": "User requesting deletion"
        }
      ]
    },
    "response": {
      "delete_job_id": "string",
      "status": "string"
    }
  },
  {
    "path": "/jobs/debug/last-error",
    "method": "GET",
    "summary": "Get Last Export Error",
    "description": "Returns detailed information about the last failed export job.",
    "tags": ["Jobs", "Debug"],
    "parameters": [],
    "response": {
      "last_export_error": "object or null"
    }
  },
  {
    "path": "/jobs/debug/export-repro",
    "method": "GET",
    "summary": "Debug Export Reproduction",
    "description": "Tests database connections and pandas read capability for debugging exports.",
    "tags": ["Jobs", "Debug"],
    "parameters": [],
    "response": {
      "status": "string",
      "select_1": "value",
      "pandas_read": "object",
      "url_masked": "string"
    }
  },
  {
    "path": "/archive/{job_id}/manifest",
    "method": "GET",
    "summary": "Get Job Manifest",
    "description": "Retrieves the manifest JSON file for a successfully exported job.",
    "tags": ["Archive Viewer"],
    "parameters": [
      {
        "name": "job_id",
        "in": "path",
        "type": "string",
        "required": true,
        "description": "UUID of the export job"
      }
    ],
    "response": "JSON object of the manifest file"
  },
  {
    "path": "/archive/{job_id}/query/{table_name}",
    "method": "GET",
    "summary": "Query Archive Table",
    "description": "Queries the parquet files for a specific table in an archive job using DuckDB.",
    "tags": ["Archive Viewer"],
    "parameters": [
      {
        "name": "job_id",
        "in": "path",
        "type": "string",
        "required": true,
        "description": "UUID of the export job"
      },
      {
        "name": "table_name",
        "in": "path",
        "type": "string",
        "required": true,
        "description": "Name of the table to query"
      },
      {
        "name": "limit",
        "in": "query",
        "type": "integer",
        "default": 50,
        "description": "Number of records to return (max 1000)"
      },
      {
        "name": "offset",
        "in": "query",
        "type": "integer",
        "default": 0,
        "description": "Number of records to skip"
      },
      {
        "name": "start_date",
        "in": "query",
        "type": "string",
        "required": false,
        "description": "Filter by created_at >= start_date"
      },
      {
        "name": "end_date",
        "in": "query",
        "type": "string",
        "required": false,
        "description": "Filter by created_at <= end_date"
      },
      {
        "name": "sort_by",
        "in": "query",
        "type": "string",
        "required": false,
        "description": "Column name to sort by"
      },
      {
        "name": "sort_desc",
        "in": "query",
        "type": "boolean",
        "default": false,
        "description": "Sort in descending order"
      }
    ],
    "response": {
      "data": "array[object]",
      "meta": {
        "limit": "integer",
        "offset": "integer",
        "count": "integer",
        "filters": "object"
      }
    }
  }
]
